# Craft CRM

A comprehensive CRM system built with Next.js, Supabase, and Electron.

## Build Configurations

This project supports multiple build configurations to handle different deployment scenarios:

### Development Mode
```bash
bun run dev
```
- Full middleware support
- Server-side authentication
- Hot reloading

### Server Build (Recommended for web deployment)
```bash
bun run build
bun run start
```
- Full middleware support
- Server-side authentication
- API routes work normally

### Static Export (For Electron)
```bash
bun run build:static
```
- Client-side authentication only
- No middleware (handled by client-side components)
- Suitable for Electron apps

## Authentication

The project uses a hybrid authentication approach:

1. **Server-side authentication** (default): Uses Next.js middleware for route protection
2. **Client-side authentication** (static export): Uses `ProtectedRoute` component for route protection

### Middleware Configuration

The middleware is conditionally enabled based on the `STATIC_EXPORT` environment variable:

- When `STATIC_EXPORT=true`: Middleware is skipped, authentication handled client-side
- When `STATIC_EXPORT` is not set: Full middleware authentication

### Protected Routes

Protected routes are automatically handled by:
- **Middleware** (server-side) when not using static export
- **ProtectedRoute component** (client-side) when using static export

## Environment Variables

Required environment variables:
- `NEXT_PUBLIC_SUPABASE_URL`
- `NEXT_PUBLIC_SUPABASE_ANON_KEY`

Optional:
- `STATIC_EXPORT=true` - Enables static export mode

## Troubleshooting

### Middleware Error with Static Export

If you encounter the error "Middleware cannot be used with output: export", it means you're trying to use middleware with static export. Solutions:

1. **Use server build**: Remove `output: 'export'` from `next.config.ts`
2. **Use static export**: Set `STATIC_EXPORT=true` and rely on client-side authentication
3. **Hybrid approach**: Use conditional configuration as implemented

## Running the Business Hub Desktop App

An Electron environment is provided for running the Business Hub locally. Install dependencies and start the app with:

```bash
npm run electron-dev
```

This command launches the Next.js dev server and opens the Electron window. A basic SQLite database backs a small Express API at `http://localhost:4000`.
Build installers with:

```bash
npm run electron-pack
```

For a production build, export the Next.js app and then package Electron:

```bash
npm run build-electron
```

The Accounting solution page includes a **Download** button that points to
`public/business-hub-installer.exe`. Replace this placeholder file with the
installer generated by `npm run build-electron` so visitors can download the
Business Hub desktop app.

